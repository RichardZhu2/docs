<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Combining Pipelines | Pyper Docs</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Combining Pipelines" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Concurrent Python made simple" /> <meta property="og:description" content="Concurrent Python made simple" /> <link rel="canonical" href="http://localhost:4000/docs/UserGuide/CombiningPipelines" /> <meta property="og:url" content="http://localhost:4000/docs/UserGuide/CombiningPipelines" /> <meta property="og:site_name" content="Pyper Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Combining Pipelines" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Concurrent Python made simple","headline":"Combining Pipelines","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/pyper.png"}},"url":"http://localhost:4000/docs/UserGuide/CombiningPipelines"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Pyper Docs"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in User Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/UserGuide/" class="nav-list-link">User Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/UserGuide/CreatingPipelines" class="nav-list-link">Creating Pipelines</a></li><li class="nav-list-item"><a href="/docs/UserGuide/TaskParameters" class="nav-list-link">Task Parameters</a></li><li class="nav-list-item"><a href="/docs/UserGuide/CombiningPipelines" class="nav-list-link">Combining Pipelines</a></li><li class="nav-list-item"><a href="/docs/UserGuide/Considerations" class="nav-list-link">Considerations</a></li></ul></li><li class="nav-list-item"><a href="/docs/Examples/" class="nav-list-link">Examples</a></li><li class="nav-list-item"><a href="/docs/ApiReference/" class="nav-list-link">API Reference</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Pyper Docs" aria-label="Search Pyper Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/pyper-dev/pyper" class="site-button" target="_blank" rel="noopener noreferrer" > GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/UserGuide/">User Guide</a></li> <li class="breadcrumb-nav-list-item"><span>Combining Pipelines</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="combining-pipelines"> <a href="#combining-pipelines" class="anchor-heading" aria-labelledby="combining-pipelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Combining Pipelines </h1> <ol id="markdown-toc"> <li><a href="#piping-and-the--operator" id="markdown-toc-piping-and-the--operator">Piping and the <code class="language-plaintext highlighter-rouge">|</code> Operator</a></li> <li><a href="#consumer-functions-and-the--operator" id="markdown-toc-consumer-functions-and-the--operator">Consumer Functions and the <code class="language-plaintext highlighter-rouge">&gt;</code> Operator</a></li> <li><a href="#asynchronous-code" id="markdown-toc-asynchronous-code">Asynchronous Code</a></li> </ol> <h2 id="piping-and-the--operator"> <a href="#piping-and-the--operator" class="anchor-heading" aria-labelledby="piping-and-the--operator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Piping and the <code class="language-plaintext highlighter-rouge">|</code> Operator </h2> <p>The <code class="language-plaintext highlighter-rouge">|</code> operator (inspired by UNIX syntax) is used to pipe one pipeline into another. This is syntactic sugar for the <code class="language-plaintext highlighter-rouge">Pipeline.pipe</code> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyper</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">Pipeline</span>

<span class="n">p1</span> <span class="o">=</span> <span class="nf">task</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="nf">task</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="nf">task</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">new_pipeline</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">|</span> <span class="n">p2</span> <span class="o">|</span> <span class="n">p3</span>
<span class="k">assert</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">new_pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">)</span>
<span class="c1"># OR
</span><span class="n">new_pipeline</span> <span class="o">=</span> <span class="n">p1</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="n">p2</span><span class="p">).</span><span class="nf">pipe</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
<span class="k">assert</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">new_pipeline</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">)</span>
</code></pre></div></div> <p>Intuitively, this represents defining a new function that:</p> <ol> <li>takes the inputs of the first task</li> <li>takes the outputs of each task and passes them as the inputs of the next task</li> <li>finally, generates each output from the last task</li> </ol> <p>Composite pipelines can of course be combined further.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p0</span> <span class="o">=</span> <span class="nf">task</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="nf">task</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">new_new_pipeline</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">|</span> <span class="n">new_pipeline</span> <span class="o">|</span> <span class="n">p4</span>
<span class="n">new_new_new_pipeline</span> <span class="o">=</span> <span class="n">new_pipeline</span> <span class="o">|</span> <span class="n">new_new_pipeline</span>
</code></pre></div></div> <h2 id="consumer-functions-and-the--operator"> <a href="#consumer-functions-and-the--operator" class="anchor-heading" aria-labelledby="consumer-functions-and-the--operator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consumer Functions and the <code class="language-plaintext highlighter-rouge">&gt;</code> Operator </h2> <p>It is often useful to define resuable functions that process the results of a pipeline, which we’ll call a ‘consumer’. For example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="kn">from</span> <span class="n">pyper</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">step1</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">{</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">step2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span> <span class="o">|</span> <span class="p">{</span><span class="sh">"</span><span class="s">hello</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">JsonFileWriter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
    
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dict</span><span class="p">]):</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">filepath</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">step1</span> <span class="o">|</span> <span class="n">step2</span>  <span class="c1"># The pipeline
</span><span class="n">writer</span> <span class="o">=</span> <span class="nc">JsonFileWriter</span><span class="p">(</span><span class="sh">"</span><span class="s">data.json</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># A consumer
</span><span class="nf">writer</span><span class="p">(</span><span class="nf">pipeline</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>  <span class="c1"># Run
</span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">&gt;</code> operator (again inspired by UNIX syntax) is used to pipe a <code class="language-plaintext highlighter-rouge">Pipeline</code> into a consumer function (any callable that takes a data stream) returning simply a function that handles the ‘run’ operation. This is syntactic sugar for the <code class="language-plaintext highlighter-rouge">Pipeline.consume</code> method.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">run</span> <span class="o">=</span> <span class="n">step1</span> <span class="o">|</span> <span class="n">step2</span> <span class="o">&gt;</span> <span class="nc">JsonFileWriter</span><span class="p">(</span><span class="sh">"</span><span class="s">data.json</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">run</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># OR
</span><span class="n">run</span> <span class="o">=</span> <span class="n">step1</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="n">step2</span><span class="p">).</span><span class="nf">consume</span><span class="p">(</span><span class="nc">JsonFileWriter</span><span class="p">(</span><span class="sh">"</span><span class="s">data.json</span><span class="sh">"</span><span class="p">))</span>
<span class="nf">run</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div> <p>The operator <code class="language-plaintext highlighter-rouge">&gt;</code> is obviously not to be taken to mean ‘greater than’ when used in these contexts.</p> <p class="info">Pyper comes with fantastic IDE intellisense support which understands these operators, and will always show you what the resulting type of a variable is (including the input and output type specs for pipelines)</p> <h2 id="asynchronous-code"> <a href="#asynchronous-code" class="anchor-heading" aria-labelledby="asynchronous-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Asynchronous Code </h2> <p>Recall that an <code class="language-plaintext highlighter-rouge">AsyncPipeline</code> is created from an asynchronous function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyper</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">AsyncPipeline</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">yield</span> <span class="mi">1</span>
    <span class="k">yield</span> <span class="mi">2</span>

<span class="k">assert</span> <span class="nf">isinstance</span><span class="p">(</span><span class="nf">task</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="n">AsyncPipeline</span><span class="p">)</span>
</code></pre></div></div> <p>When combining pipelines, the following rule applies:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Pipeline</code> &gt; <code class="language-plaintext highlighter-rouge">Pipeline</code> = <code class="language-plaintext highlighter-rouge">Pipeline</code></li> <li><code class="language-plaintext highlighter-rouge">Pipeline</code> &gt; <code class="language-plaintext highlighter-rouge">AsyncPipeline</code> = <code class="language-plaintext highlighter-rouge">AsyncPipeline</code></li> <li><code class="language-plaintext highlighter-rouge">AsyncPipeline</code> &gt; <code class="language-plaintext highlighter-rouge">Pipeline</code> = <code class="language-plaintext highlighter-rouge">AsyncPipeline</code></li> <li><code class="language-plaintext highlighter-rouge">AsyncPipeline</code> &gt; <code class="language-plaintext highlighter-rouge">AsyncPipeline</code> = <code class="language-plaintext highlighter-rouge">AsyncPipeline</code></li> </ul> <p>In other words:</p> <p class="info">A pipeline that contains <em>at least one</em> asynchronous task becomes asynchronous</p> <p>This reflects a (sometimes awkward) trait of Python, which is that <code class="language-plaintext highlighter-rouge">async</code> and <code class="language-plaintext highlighter-rouge">await</code> syntax bleeds everywhere – as soon as one function is defined asynchronously, you often find that many other parts program need to become asynchronous. Hence, the sync vs async decision is usually one made at the start of designing an application.</p> <p>The Pyper framework slightly assuages the developer experience by allowing synchronous functions to be used inside of an <code class="language-plaintext highlighter-rouge">AsyncPipeline</code>. Pyper will handle unifying synchronous and asynchronous execution under the hood.</p> <p>Consumer functions will, however need to adapt to asynchronous output. For example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="kn">from</span> <span class="n">pyper</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">step1</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">{</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">step2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span> <span class="o">|</span> <span class="p">{</span><span class="sh">"</span><span class="s">hello</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">JsonFileWriter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dict</span><span class="p">]):</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">async</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">filepath</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">step1</span> <span class="o">|</span> <span class="n">step2</span> <span class="o">&gt;</span> <span class="nc">JsonFileWriter</span><span class="p">(</span><span class="sh">"</span><span class="s">data.json</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">await</span> <span class="nf">run</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
